<!DOCTYPE html>
<html lang="en" data-accent-color="lime" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Proxy Contracts - ape documentation</title><link rel="shortcut icon" href="../_static/favicon.ico"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Contract Creation Metadata" href="contract_metadata.html" /><link rel="prev" title="Publishing" href="publishing.html" />
      <link rel="canonical" href="ape/userguides/proxy.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=c516b45e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
<meta property="og:url" content="ape/userguides/proxy.html"/>
<meta property="og:title" content="Proxy Contracts"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      <img class="light-logo" src="../_static/logo_grey.svg" alt="ape" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/logo_green.svg" alt="ape" height="28" loading="lazy" />
      <strong>ape</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Developing Projects with Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configure Ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="compile.html">Compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts.html">Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="reverts.html">Reverts</a></li>
<li class="toctree-l1"><a class="reference internal" href="networks.html">Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="forking_networks.html">Forking Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="publishing.html">Publishing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Proxy Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="contract_metadata.html">Contract Creation Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html">Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">Traces</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Querying Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="clis.html">CLIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_plugins.html">Developing Plugins</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">CLI Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../commands/accounts.html">accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/compile.html">compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/console.html">console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/init.html">init</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/networks.html">networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/plugins.html">plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/pm.html">pm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/test.html">test</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Core Python Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape.html">ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/api.html">ape.api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/cli.html">ape.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/contracts.html">ape.contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/exceptions.html">ape.exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/managers.html">ape.managers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/plugins.html">ape.plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/types.html">ape.types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/utils.html">ape.utils</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Plugin Python Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_accounts.html">ape-accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_compile.html">ape-compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_ethereum.html">ape-ethereum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_ethereum.html#module-ape_ethereum.multicall">ape-ethereum.multicall</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_node.html">ape-node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_pm.html">ape-pm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape_test.html">ape-test</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#automatic-proxy-detection">Automatic Proxy Detection</a></li>
<li><a class="reference internal" href="#manual-proxy-configuration">Manual Proxy Configuration</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6"><div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ape</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Proxy Contracts</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="proxy-contracts">
<h1>Proxy Contracts<a class="headerlink" href="#proxy-contracts" title="Link to this heading"></a></h1>
<p>Ape is able to detect proxy contracts so that it uses the target interface when interacting with a contract.
The following proxies are supported in <code class="docutils literal notranslate"><span class="pre">ape-ethereum</span></code>:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Proxy Type</p></th>
<th class="head"><p>Short Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Minimal</p></td>
<td><p>EIP-1167</p></td>
</tr>
<tr class="row-odd"><td><p>Standard</p></td>
<td><p>EIP-1967</p></td>
</tr>
<tr class="row-even"><td><p>Beacon</p></td>
<td><p>EIP-1967</p></td>
</tr>
<tr class="row-odd"><td><p>UUPS</p></td>
<td><p>EIP-1822</p></td>
</tr>
<tr class="row-even"><td><p>Vyper</p></td>
<td><p>vyper &lt;0.2.9 create_forwarder_to</p></td>
</tr>
<tr class="row-odd"><td><p>Clones</p></td>
<td><p>0xsplits clones</p></td>
</tr>
<tr class="row-even"><td><p>Safe</p></td>
<td><p>Formerly Gnosis Safe</p></td>
</tr>
<tr class="row-odd"><td><p>OpenZeppelin</p></td>
<td><p>OZ Upgradable</p></td>
</tr>
<tr class="row-even"><td><p>Delegate</p></td>
<td><p>EIP-897</p></td>
</tr>
<tr class="row-odd"><td><p>ZeroAge</p></td>
<td><p>A minimal proxy</p></td>
</tr>
<tr class="row-even"><td><p>SoladyPush0</p></td>
<td><p>Uses PUSH0</p></td>
</tr>
</tbody>
</table>
</div>
<section id="automatic-proxy-detection">
<h2>Automatic Proxy Detection<a class="headerlink" href="#automatic-proxy-detection" title="Link to this heading"></a></h2>
<p>Proxy detection occurs when attempting to retrieve contract types in Ape.
Ape uses various sources to find contract types, such as explorer APIs.
See <a class="reference external" href="./contracts.html">this guide</a> to learn more about initializing contracts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">ape</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contract</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Automatic proxy detection (default behavior)</span>
</span><span data-line="4"><span class="n">my_contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0x...&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p>Ape will check the address you give it and detect if it hosts a proxy contract.
In the case where it determines the address is a proxy contract, it resolves the address of the implementation (every proxy is different) and returns the interface for the implementation contract.
This allows you to still call methods as you normally do on proxy contracts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># `my_contract` address points to a proxy with no methods in the interface</span>
</span><span data-line="2"><span class="c1"># However, Ape detected the implementation type and can find methods to call that way.</span>
</span><span data-line="3"><span class="n">my_contract</span><span class="o">.</span><span class="n">my_method</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="manual-proxy-configuration">
<h2>Manual Proxy Configuration<a class="headerlink" href="#manual-proxy-configuration" title="Link to this heading"></a></h2>
<p>If you need more control over proxy behavior, you can manually specify proxy information when creating contract instances with <code class="docutils literal notranslate"><span class="pre">ContractContainer.at()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">ape</span><span class="w"> </span><span class="kn">import</span> <span class="n">project</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">ape.api.networks</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyInfoAPI</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">ape_ethereum.proxies</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyInfo</span><span class="p">,</span> <span class="n">ProxyType</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Create proxy info with implementation address</span>
</span><span data-line="6"><span class="n">proxy_info</span> <span class="o">=</span> <span class="n">ProxyInfo</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;0x1234567890123456789012345678901234567890&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">ProxyType</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Create contract instance with manual proxy configuration</span>
</span><span data-line="9"><span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyImplementation</span><span class="o">.</span><span class="n">at</span><span class="p">(</span>
</span><span data-line="10">    <span class="s2">&quot;0xProxyAddress&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="c1"># Provide proxy information manually</span>
</span><span data-line="12">    <span class="n">proxy_info</span><span class="o">=</span><span class="n">proxy_info</span><span class="p">,</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Or disable proxy detection entirely if you know it&#39;s not a proxy</span>
</span><span data-line="16"><span class="n">contract</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">MyContract</span><span class="o">.</span><span class="n">at</span><span class="p">(</span>
</span><span data-line="17">    <span class="s2">&quot;0xAddress&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">detect_proxy</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="19"><span class="p">)</span>
</span></pre></div>
</div>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">Contract</span></code> factory with proxy parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">ape</span><span class="w"> </span><span class="kn">import</span> <span class="n">Contract</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Disable proxy detection</span>
</span><span data-line="4"><span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span><span class="s2">&quot;0xAddress&quot;</span><span class="p">,</span> <span class="n">detect_proxy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Provide custom proxy info</span>
</span><span data-line="7"><span class="n">contract</span> <span class="o">=</span> <span class="n">Contract</span><span class="p">(</span>
</span><span data-line="8">    <span class="s2">&quot;0xProxyAddress&quot;</span><span class="p">,</span> 
</span><span data-line="9">    <span class="n">proxy_info</span><span class="o">=</span><span class="n">ProxyInfoAPI</span><span class="p">(</span>
</span><span data-line="10">        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;0xImplementationAddress&quot;</span><span class="p">,</span> 
</span><span data-line="11">        <span class="n">type_name</span><span class="o">=</span><span class="n">ProxyType</span><span class="o">.</span><span class="n">STANDARD</span>
</span><span data-line="12">    <span class="p">)</span>
</span><span data-line="13"><span class="p">)</span>
</span></pre></div>
</div>
<p>This is particularly useful when:</p>
<ol class="arabic simple">
<li><p>Automatic detection fails to identify a proxy contract</p></li>
<li><p>You want to force a specific implementation address</p></li>
<li><p>You’re working with a custom or unusual proxy pattern</p></li>
</ol>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="publishing.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Publishing</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="contract_metadata.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Contract Creation Metadata</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024, ApeWorX LTD</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script data-domain="docs.apeworx.io" defer="defer" src="https://plausible.io/js/script.js"></script>
      <script src="../_static/shibuya.js?v=e2230717"></script></body>
</html>